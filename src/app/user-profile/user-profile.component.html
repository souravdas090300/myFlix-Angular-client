<div class="profile-page">
  <!-- Modern Navigation Toolbar -->
  <mat-toolbar color="primary" class="modern-navbar">
    <span class="brand-title">myFlix</span>
    <span class="spacer"></span>
    <button mat-button routerLink="/movies" class="nav-btn">
      <mat-icon>video_library</mat-icon>
      <span class="button-text">Movies</span>
    </button>
    <button mat-button routerLink="/profile" class="nav-btn active">
      <mat-icon>person</mat-icon>
      <span class="button-text">Profile</span>
    </button>
    <button mat-button (click)="logout()" class="nav-btn logout-btn">
      <mat-icon>logout</mat-icon>
      <span class="button-text">Logout</span>
    </button>
  </mat-toolbar>

  <!-- Profile content -->
  <div class="user-profile-container">
    <mat-card class="profile-card">
      <mat-card-header class="profile-header">
        <div mat-card-avatar class="profile-avatar">
          <mat-icon>person</mat-icon>
        </div>
        <mat-card-title>My Profile</mat-card-title>
        <mat-card-subtitle>Manage your account information</mat-card-subtitle>
      </mat-card-header>
    
      <mat-card-content>
        <!-- Loading state -->
        <div *ngIf="isLoading" class="loading-state">
          <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
          <p>Loading profile...</p>
        </div>

        <!-- No user data -->
        <div *ngIf="!isLoading && !user" class="no-user-data">
          <p>No user data available. Please log in first.</p>
          <button mat-raised-button color="primary" routerLink="/welcome">Go to Login</button>
        </div>

        <!-- Display current user info -->
        <div class="user-info-display" *ngIf="!editMode && user && !isLoading">
          <div class="info-item">
            <mat-icon>person</mat-icon>
            <div class="info-content">
              <div class="info-label">Username</div>
              <div class="info-value">{{ user?.Username || 'Not provided' }}</div>
            </div>
          </div>
          
          <div class="info-item">
            <mat-icon>email</mat-icon>
            <div class="info-content">
              <div class="info-label">Email</div>
              <div class="info-value">{{ user?.Email || 'Not provided' }}</div>
            </div>
          </div>
          
          <div class="info-item">
            <mat-icon>cake</mat-icon>
            <div class="info-content">
              <div class="info-label">Birthday</div>
              <div class="info-value">{{ formatBirthday(user.Birthday) }}</div>
            </div>
          </div>
          
          <div class="info-item">
            <mat-icon>favorite</mat-icon>
            <div class="info-content">
              <div class="info-label">Favorite Movies</div>
              <div class="info-value">{{ user?.FavoriteMovies?.length || 0 }} movies</div>
            </div>
          </div>
        </div>

        <!-- Favorite Movies List -->
        <div class="favorite-movies-section" *ngIf="!editMode && user && !isLoading">
          <h3 class="section-title">
            <mat-icon>favorite</mat-icon>
            My Favorite Movies
          </h3>
          
          <div class="favorite-movies-grid" *ngIf="favoriteMovies.length > 0">
            <div class="favorite-movie-card" *ngFor="let movie of favoriteMovies">
              <div class="movie-poster">
                <img [src]="movie.ImagePath" [alt]="movie.Title" (error)="movie.ImagePath = 'assets/default-movie.jpg'" />
              </div>
              <div class="movie-info">
                <h4 class="movie-title">{{ movie.Title }}</h4>
                <p class="movie-director">{{ movie.Director?.Name || 'Unknown Director' }}</p>
                <p class="movie-genre">{{ movie.Genre?.Name || 'Unknown Genre' }}</p>
                <div class="movie-actions">
                  <button 
                    mat-icon-button 
                    color="warn"
                    (click)="removeFromFavorites(movie._id)"
                    matTooltip="Remove from favorites">
                    <mat-icon>favorite</mat-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Empty state -->
          <div class="empty-favorites" *ngIf="favoriteMovies.length === 0">
            <mat-icon class="empty-icon">movie_creation</mat-icon>
            <h4>No favorite movies yet</h4>
            <p>Start browsing movies and add them to your favorites!</p>
            <button mat-raised-button color="primary" routerLink="/movies">
              <mat-icon>movie</mat-icon>
              Browse Movies
            </button>
          </div>
        </div>

        <!-- Edit form -->
        <form class="profile-form" *ngIf="editMode && user && !isLoading">
          <!-- Username field -->
          <mat-form-field appearance="outline">
            <mat-label>Username *</mat-label>
            <input 
              matInput 
              [(ngModel)]="editedUser.Username" 
              name="Username" 
              type="text"
              required>
            <mat-icon matSuffix>person</mat-icon>
            <mat-error *ngIf="validationErrors.username">{{ validationErrors.username }}</mat-error>
            <mat-error *ngIf="!editedUser.Username && !validationErrors.username">Username is required</mat-error>
          </mat-form-field>
          
          <!-- Email field -->
          <mat-form-field appearance="outline">
            <mat-label>Email *</mat-label>
            <input 
              matInput 
              [(ngModel)]="editedUser.Email" 
              name="Email" 
              type="email"
              required>
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="validationErrors.email">{{ validationErrors.email }}</mat-error>
            <mat-error *ngIf="!editedUser.Email && !validationErrors.email">Email is required</mat-error>
          </mat-form-field>
          
          <!-- Password field with clear instructions -->
          <mat-form-field appearance="outline">
            <mat-label>Password *</mat-label>
            <input 
              matInput 
              [(ngModel)]="editedUser.Password" 
              name="Password" 
              type="password"
              required
              placeholder="Enter your current password or a new password">
            <mat-icon matSuffix>lock</mat-icon>
            <mat-hint>Enter your current password to keep it, or enter a new password to change it</mat-hint>
            <mat-error *ngIf="validationErrors.password">{{ validationErrors.password }}</mat-error>
            <mat-error *ngIf="!editedUser.Password && !validationErrors.password">Password is required</mat-error>
          </mat-form-field>
          
          <!-- Birthday field -->
          <mat-form-field appearance="outline">
            <mat-label>Birthday</mat-label>
            <input 
              matInput 
              [(ngModel)]="editedUser.Birthday" 
              name="Birthday" 
              type="date">
            <mat-icon matSuffix>cake</mat-icon>
          </mat-form-field>
        </form>
      </mat-card-content>
    
      <mat-card-actions class="action-buttons">
        <div class="button-group" *ngIf="!editMode && user && !isLoading">
          <button 
            mat-raised-button 
            color="primary" 
            (click)="toggleEditMode()"
            class="action-btn">
            <mat-icon>edit</mat-icon>
            Edit Profile
          </button>
          
          <button 
            mat-raised-button 
            color="accent" 
            routerLink="/movies"
            class="action-btn">
            <mat-icon>movie</mat-icon>
            Back to Movies
          </button>
        </div>

        <div class="button-group" *ngIf="editMode && user && !isLoading">
          <button 
            mat-raised-button 
            color="primary" 
            (click)="updateUser()"
            class="action-btn">
            <mat-icon>save</mat-icon>
            Save Changes
          </button>
          
          <button 
            mat-raised-button 
            color="basic" 
            (click)="cancelEdit()"
            class="action-btn">
            <mat-icon>cancel</mat-icon>
            Cancel
          </button>
        </div>

        <div class="danger-zone" *ngIf="user && !isLoading">
          <button 
            mat-stroked-button 
            color="warn" 
            (click)="deleteUser()"
            class="delete-btn">
            <mat-icon>delete</mat-icon>
            Delete Account
          </button>
        </div>
      </mat-card-actions>
    </mat-card>
  </div>
</div>